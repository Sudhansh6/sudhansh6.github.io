<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Handling broken python packages | Sudhansh Peddabomma</title> <meta name="author" content="Sudhansh Peddabomma"> <meta name="description" content="A post to guide you through mending python libraries on Ubuntu"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%BE&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://sudhansh6.github.io/blog/Fix-Python-Ubuntu/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?6185d15ea1982787ad7f435576553d64"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Sudhansh Peddabomma</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Articles</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/challenges/">Challenges</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/misc/">Miscellaneous</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Handling broken python packages</h1> <p class="post-meta">June 21, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/category/articles"> <i class="fa-solid fa-tag fa-sm"></i> Articles</a>   <a href="/blog/category/ubuntu"> <i class="fa-solid fa-tag fa-sm"></i> Ubuntu</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>If you knowingly or unknowingly deleted python files from your Ubuntu, this article is for you. Although a disclaimer: I’m not highly versed with operating systems, this makeshift method seems to fix the problem. I spent a rather frustrating day trying to get out of this situation, and I did not find a single good resource. So, I planned to write out this post to consolidate all the fixes that may resolve the issue. If none of the methods work, your best bet is to reinstall Ubuntu entirely without any hassle.</p> <h1 id="how-i-stumbled-across-the-problem">How I stumbled across the problem</h1> <p>I love updating my OS to the latest build available. On account of this, I updated my Ubuntu to <a href="https://releases.ubuntu.com/21.04/" rel="external nofollow noopener" target="_blank">21.04 Hirsute Hippo</a> yesterday. The update took 3-4 hours to finish, and I was delighted with the new OS. After wasting a whole day updating the OS and testing out <a href="https://sudhansh6.github.io/blog/Windows-11">Windows 11</a>, I decided I should get back to work.</p> <p>I started out with a project which requires python. On executing, the code (which was working previously) gave an error saying some modules were missing. I realized the new OS update had replaced <code class="language-plaintext highlighter-rouge">python3.8</code> with <code class="language-plaintext highlighter-rouge">python3.9</code>. I was annoyed thinking that all my modules were deleted during the update.</p> <p>To check this, I headed out to <code class="language-plaintext highlighter-rouge">/usr/lib/</code> to check for the same. I saw no trace of <code class="language-plaintext highlighter-rouge">python3.8</code>, and there were 5 other versions of python installed. I was foolish enough to think those versions were unnecessary, and I unwittingly deleted <code class="language-plaintext highlighter-rouge">python2.7</code> and <code class="language-plaintext highlighter-rouge">python3</code>. Deleting these files required <code class="language-plaintext highlighter-rouge">sudo</code> and <code class="language-plaintext highlighter-rouge">root</code> access, and for a good reason. This action initiated my day of incessant browsing and fruitless fixing attempts.</p> <p>I later learned that all my modules of <code class="language-plaintext highlighter-rouge">python3.8</code> were safe in the local installation at <code class="language-plaintext highlighter-rouge">/usr/local/lib</code>. I wish I knew this before. Anyway, once I deleted those files, everything started malfunctioning. <code class="language-plaintext highlighter-rouge">apt</code> and <code class="language-plaintext highlighter-rouge">dpkg</code> gave errors, and the terminal was not opening too!</p> <h1 id="how-to-fix-the-problem">How to fix the problem?</h1> <p>Before I go into what finally restored my software, I’ll list out a couple of commands I came across. If you are lucky, these might just solve your problem.</p> <h2 id="method-1-using-apt-and-dpkg"><a name="standard">Method 1: Using <code class="language-plaintext highlighter-rouge">apt</code> and <code class="language-plaintext highlighter-rouge">dpkg</code></a></h2> <p>Try the following commands:</p> <ol> <li> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nt">-f</span> <span class="nb">install</span>
</code></pre></div> </div> <p>According to <code class="language-plaintext highlighter-rouge">man apt-get</code>, the <code class="language-plaintext highlighter-rouge">-f</code> or <code class="language-plaintext highlighter-rouge">--fix-broken</code> flag is an attempt to correct a system with broken dependencies in place. When used with install/remove, this option can omit any packages to permit APT to deduce a possible solution.</p> </li> <li> <p>The above does not work when a system’s dependency structure can be so corrupt as to require manual intervention. Then, you can try</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dpkg <span class="nt">--configure</span> <span class="nt">-a</span> 
</code></pre></div> </div> <p>This command configures all unpacked packages.</p> </li> </ol> <h2 id="method-2-relinking-links-and-binaries">Method 2: Relinking links and binaries</h2> <p>The above was a cleaner fix using the package installers themselves. Now, we enter the makeshift regime. If you simply deleted <code class="language-plaintext highlighter-rouge">usr/bin/python*</code>, the following may work:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">--reinstall</span> python<span class="k">*</span><span class="nt">-minimal</span>
<span class="c"># Replace the * with the required version. For example, for python2.7 use:</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">--reinstall</span> python2.7-minimal
</code></pre></div></div> <blockquote> <p>In case your terminal is not working, you can try this:</p> <ul> <li>If you have Visual Studio Code installed, use the inbuilt terminal to execute the above.</li> <li>If xterm is installed, try using that.</li> <li>Otherwise, just access a <a href="https://askubuntu.com/questions/66195/what-is-a-tty-and-how-do-i-access-a-tty" rel="external nofollow noopener" target="_blank">tty</a> using <code class="language-plaintext highlighter-rouge">Ctrl + Alt + F[1-6]</code> and execute the above.</li> </ul> </blockquote> <p>​ If only the <a name="symlink"></a><a href="https://www.freecodecamp.org/news/symlink-tutorial-in-linux-how-to-create-and-remove-a-symbolic-link/" rel="external nofollow noopener" target="_blank"><strong>symbolic links</strong></a> are broken, you can simply create a new link and restore your system.</p> <p>​ Usually, a <code class="language-plaintext highlighter-rouge">python3</code> link points to the <code class="language-plaintext highlighter-rouge">python3.*</code> binary executable. Suppose you have <code class="language-plaintext highlighter-rouge">python3.8</code> installed, you can create a symlink using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Creates a symbolic link to python3.8 from python3</span>
<span class="nb">sudo ln</span> <span class="nt">-s</span> /usr/bin/python3.8 /usr/bin/python3
</code></pre></div></div> <h2 id="method-3-my-hack">Method 3: My Hack</h2> <p>Without further ado, let me tell you what worked for me. My idea was to copy the correct files from a faultless installation of Ubuntu. It is unlikely that you have these files (if you do, then skip to <a href="#Restoring-everything">this</a>), and you need to create a bootable to get these.</p> <h3 id="creating-a-bootable">Creating a bootable</h3> <p>The first step is to download the <code class="language-plaintext highlighter-rouge">iso</code> file from the <a href="https://ubuntu.com/download" rel="external nofollow noopener" target="_blank">Ubuntu website</a> and acquire an empty USB stick.</p> <p>If your terminal is not working, it is improbable that the <a href="https://ubuntu.com/tutorials/create-a-usb-stick-on-ubuntu#1-overview" rel="external nofollow noopener" target="_blank"><em>Startup Disk Creator</em></a> tool works. Therefore, we will use a CLI tool called <strong>ddrescue</strong> to create the bootable.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>gddrescue
</code></pre></div></div> <p>This is expected to work if <code class="language-plaintext highlighter-rouge">apt</code> is not entirely broken. Next, we check the block device volume of the USB drive (I hope you plugged in your USB).</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsblk
</code></pre></div></div> <p>The USB drive may be present in <code class="language-plaintext highlighter-rouge">dev/sdb/</code>. Then, we simply use the following to create the bootable</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ddrescue path/to.iso dev/sd<span class="k">*</span> <span class="nt">--</span> force <span class="nt">-D</span>
<span class="c"># For example, if USB is present in sdb use</span>
<span class="nb">sudo </span>ddrescue ~/ubuntu-21.04-desktop-amd64.iso /dev/sdb <span class="nt">--force</span> <span class="nt">-D</span>
</code></pre></div></div> <p>This may take a few minutes, and your USB will be ready after this.</p> <h3 id="copying-working-files">Copying working files</h3> <p>If your system has only Ubuntu installed, then you might be able to reinstall Ubuntu, keeping your data intact. Otherwise, use the ‘Try Ubuntu’ option.</p> <p>Once the OS loads, open the file explorer. Copy the <code class="language-plaintext highlighter-rouge">usr/bin/</code> and <code class="language-plaintext highlighter-rouge">usr/lib/</code> folder from the Ubuntu instance running on your USB to some location (say <code class="language-plaintext highlighter-rouge">foo/</code> on your hard drive). If you do not have the permissions to do so, use this in the destination directory</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod</span> <span class="nt">-R</span> 777 <span class="nb">.</span>
</code></pre></div></div> <p>Restart the system again, unplug the USB, and boot into Ubuntu.</p> <h3 id="restoring-everything"><a name="Restoring-everything">Restoring everything</a></h3> <p>This part is straightforward, but we must proceed with care.</p> <p>Open up the <code class="language-plaintext highlighter-rouge">foo/usr/bin/</code> folder from the files you copied and the <code class="language-plaintext highlighter-rouge">usr/bin/</code> in your system. List all the files relevant to python using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> | <span class="nb">grep </span>python
</code></pre></div></div> <p>Delete the existing executables, and then copy the python executables first using</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> /usr/bin/python3.8
<span class="nb">sudo mv </span>foo/usr/bin/python3.8 /usr/bin/python3.8
</code></pre></div></div> <p>We then create the symbolic links as present in <code class="language-plaintext highlighter-rouge">foo/usr/bin/</code> using the command mentioned <a href="#symlink">above</a>. This fixes the <code class="language-plaintext highlighter-rouge">/bin/</code> folder. Now, do the same in the <code class="language-plaintext highlighter-rouge">lib</code> folder. Copy <code class="language-plaintext highlighter-rouge">python3</code> and <code class="language-plaintext highlighter-rouge">python3.9</code> (these two are present if you are using Ubuntu 21.04) into <code class="language-plaintext highlighter-rouge">usr/lib/</code></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> <span class="nt">-R</span> /usr/lib/python3
<span class="nb">sudo mv</span> <span class="nt">-R</span> foo/usr/lib/python3 /usr/lib
</code></pre></div></div> <p>Change the ownership of the copied files to root using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown </span>root:root /usr/bin/python3.8
<span class="nb">sudo chown</span> <span class="nt">-R</span> root:root /usr/bin/python3
</code></pre></div></div> <p>After transferring the files, repeat <a href="#standard">these</a> to patch everything up. You’re done!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/Lattices-in-Cryptography/">Lattices in Cryptography and Quantum Computers</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/Object-Detection/">Object Detection</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/Windows-11/">Windows 11</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/GANs-for-Compressed-Sensing/">Generative Adversarial Networks for Compressed Sensing</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/Modulo-Compressed-Sensing/">Modulo Compressed Sensing</a> </li> </div> <script>document.querySelectorAll("#table-of-contents a").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substring(1);document.querySelectorAll(".content-section").forEach(function(e){e.classList.add("hidden")});var n=document.getElementById(t);n&&n.classList.remove("hidden")})});</script> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Sudhansh Peddabomma. Last updated: April 27, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-0K9MLG0V24"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0K9MLG0V24");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>