document.addEventListener("DOMContentLoaded",()=>{function e(){const e="block"===o.style.display;o.style.display=e?"none":"block"}function t(e,t){const n=document.createElement("div");n.classList.add("chat-message",t),n.textContent=e,l.appendChild(n),l.scrollTop=l.scrollHeight}function n(e){const t=l.querySelector(".thinking");if(e&&!t){const e=document.createElement("div");e.classList.add("thinking"),e.textContent="Thinking...",l.appendChild(e),l.scrollTop=l.scrollHeight}else!e&&t&&t.remove()}async function s(){if(m)return;const e=a.value.trim();if(a.value="",e){t(e,"user-message"),n(!0),m=!0;try{const c=await fetch("https://tznrpdmwzpuispggvpdk.supabase.co/functions/v1/public-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:"139ee9d1-61d2-4033-aa8b-36505d0da281",content:e,conversation_id:r})}),o=await c.json();r=o.reply.conversation_id,n(!1),t(o.reply.content,"server-message")}catch(s){n(!1),t("Sorry, there was an error. Please try again.","server-message")}m=!1}}const c=document.getElementById("chat-toggle-btn"),o=document.getElementById("chat-window"),d=document.getElementById("close-chat"),a=document.getElementById("chat-input"),i=document.getElementById("send-btn"),l=document.getElementById("chat-messages");let r=null,m=!1;c.addEventListener("click",e),d.addEventListener("click",()=>{o.style.display="none"}),i.addEventListener("click",s),a.addEventListener("keypress",e=>{"Enter"===e.key&&s()})});