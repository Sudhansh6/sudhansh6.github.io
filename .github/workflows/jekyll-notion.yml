name: Fetch notion pages

on:
  push:
    branches:
      - master  # Here source code branch is `master`, it could be other branch

jobs:
  notion-sync:
    stage: deploy
    runs-on: ubuntu-latest
    env:
      NOTION_TOKEN: secret_BiokHV3wX3KhaIVzUg34cxteDKkNX9kG3Ut7hnfepCA
    script:
      - |
        # run our synchronization command
        bundle exec jekyll prefetch
        
        # if there are any changes from notion ...
        # note: be sure that all files produced by 
        #       (i.e. bundle install) are git-ignored
        if [[ $(git status --porcelain) ]]; then
          git config user.name "$BOT_NAME"
          git config user.email "$BOT_EMAIL"
          git add .
          git commit -m "Notion sync $(date +'%Y-%m-%d')"
          
          # git remote add ci "https://$TOKEN_NAME:$ACCESS_TOKEN@gitlab.com/<username>/<your-repo>.git"
          git push ci HEAD:$CI_COMMIT_REF_NAME
        fi